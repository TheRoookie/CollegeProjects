# ============================================================
# Car Parking Space Counter — Configuration File
# ============================================================

# --- Video Source ---
video:
  # Path to a local .mp4 file OR an RTSP URL string, e.g. "rtsp://..."
  # Leave blank to open a file-picker dialog at startup.
  source: ""
  # Target processing width (frames are resized to this before inference)
  process_width: 640
  # Playback FPS cap — how fast the video plays (0 = no cap, native speed)
  max_fps: 30
  # Detection FPS — how many times per second detection+classification runs.
  # e.g. video=30fps, detection_fps=1 → detect on 1 frame per second,
  # display all 30 frames (video plays at full speed, only 10 detections for a 10-sec clip).
  detection_fps: 1

# --- ROI (Parking Spot Coordinates) ---
roi:
  # JSON file containing polygon coordinates for each parking space.
  # Generated by the draw_rois.py tool or loaded from an existing file.
  coordinates_file: "assets/parking_spots.json"

# --- YOLOv8 Object Detection ---
detection:
  model_weights: "assets/yolo26m.pt"   # auto-downloaded on first run
  confidence_threshold: 0.45
  iou_threshold: 0.45
  # COCO class IDs to treat as vehicles: car=2, motorcycle=3, bus=5, truck=7
  vehicle_classes: [2, 3, 5, 7]
  device: "cpu"    # "cpu" | "cuda" | "mps"

# --- Centroid Tracker ---
tracker:
  # Maximum pixel distance to associate a detection with an existing track
  max_distance: 50
  # Frames a track can be missing before it is removed
  max_disappeared: 20

# --- Parking Space Classifier ---
classifier:
  # Primary method: "overlap" (recommended) or "pixel_count" | "cnn"
  #
  # "overlap" — reuses the YOLO detections already running: a spot is
  #   occupied when any detected vehicle covers >= overlap_threshold of
  #   the spot's polygon area.  Accurate on any surface texture/lighting.
  #
  # "pixel_count" — legacy adaptive-threshold pixel counter.  Unreliable
  #   on textured surfaces (brick, cobblestone) and strong shadows.
  method: "overlap"

  # Fraction of a spot's polygon area that must be covered by a YOLO
  # bounding box for the spot to be considered occupied.
  # Lower → more sensitive (detects partially-parked cars).
  # Higher → less sensitive (only flags fully-parked cars).
  overlap_threshold: 0.25

  # ---- pixel_count fallback settings (used automatically when YOLO fails) ----
  # Adaptive threshold approach: low pixel count = occupied, high = empty.
  # Brick/cobblestone produces many locally-dark pixels (empty); a smooth
  # car body produces few (occupied). Threshold scales with patch size.
  count_threshold: 3000     # white-pixel count below which a spot is OCCUPIED
  blur_kernel: 3           # small blur to suppress compression noise only
  adaptive_block: 25       # neighbourhood size (px) for adaptive threshold
  adaptive_c: 16           # subtracted from local mean; larger = more selective
  status_debounce: 2       # moved here for clarity (was already used)

  # Number of consecutive detection frames that must agree before a spot
  # changes status. Prevents single-frame flicker.
  status_debounce: 2

# --- Display / Overlay Colors (BGR) ---
display:
  empty_color:    [0, 200, 0]      # green
  occupied_color: [0, 0, 220]      # red
  unknown_color:  [200, 200, 0]    # yellow
  box_thickness: 2
  font_scale: 0.5
